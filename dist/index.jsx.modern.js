import e,{useContext as t,useState as n,createContext as r,useEffect as o,Fragment as a}from"react";import l from"react-dom";import"ionicons/icons";import"@material-ui/core";import i from"@material-ui/core/Box";import{ChevronLeft as c,ChevronRight as s,Close as m,Menu as u}from"@material-ui/icons";import d from"prop-types";import{useHistory as p}from"react-router-dom";import g from"styled-components";import f from"axios";import{toast as h}from"react-toastify";import"@capacitor/core";import v from"react-modal";import"@ionic/react";import y from"@material-ui/core/Drawer";import E from"@material-ui/core/Fab";import"@material-ui/core/IconButton";import x from"@material-ui/core/List";import w from"@material-ui/core/ListItem";import"@material-ui/core/ListItemIcon";function b(){return(b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function C(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t.indexOf(n=a[r])>=0||(o[n]=e[n]);return o}function M(e,t){return t||(t=e.slice(0)),e.raw=t,e}var O={anonUser:{},bottomDrawerOpen:"bottom-drawer-open",collapsible:{description:"descr-sec",extra1:"extra1-sec",extra2:"extra2-sec",extra3:"extra3-sec",map:"map-sec",markers:"markers-sec"},collapsibles:"collapsibles",current_user:"current_user",horizontal:"horizontal",item_types:{gallery:"Gallery",report:"Report",video:"Video"},jwt_token:"jwt_token",layout_onecol:"onecol",layout_mapui:"mapui",locations:{earth:"earth"},map_panel_types:{Equirectangular:"Equirectangular",MapPanel:"MapPanel",MapPanelNoZoom:"MapPanelNoZoom",ThreePanelV1:"ThreePanelV1",ThreePanelV4:"ThreePanelV4"},names:{scratchpad:"Scratchpad"},rated:{nc17:"nc-17"},ratedConfirmation:"rated-confirmation",theme:"theme",themes:{dark:"dark",light:"light"},twofoldPercent:"twofold-percent",variants:{bordered:"bordered",floating:"floating",inline:"inline",transparent:"transparent"},vertical:"vertical"};f.create({});var k,P,L,R,j,_,T,I,N,S,F,U,A,B,z=["children"],D=["children"],q=["children","onClose"],V=g.div(k||(k=M(["\n\n  // @TODO: this should use variables, for Modal inner size.\n  // I'd need to do dependency injection of the variable, from infiniteshelterjs into ishlibjs.\n  position: fixed; // for GalleriesShow\n  top: 60px;\n  right: 60px;\n\n  display: flex;\n  flex-direction: row-reverse;\n"]))),J=(g.div(P||(P=M(["\n  margin-right: 5px;\n  cursor: pointer;\n"]))),g.div(L||(L=M(["\n  border: 1px solid gray;\n  border-radius: 5px;\n  cursor: pointer;\n  display: inline-block;\n  padding: .3em 1em;\n"])))),W=(g(c)(R||(R=M(["\n  color: ","\n"])),function(e){return e.theme.colors.text}),g(s)(j||(j=M(["\n  color: ","\n"])),function(e){return e.theme.colors.text}),g(i)(_||(_=M(["\n  margin-bottom: 1em;\n  padding: 1em;\n  background: white;\n  cursor: ",";\n\n  display: flex;\n  flex-direction: column;\n"])),function(e){return e.cursor?e.cursor:"auto"}),function(t){var n=C(t,z);return e.createElement(m,b({style:b({cursor:"pointer"},n.style)},n))});W.propTypes={onClick:d.func.isRequired};var G=g.div(T||(T=M(["\n  display: flex;\n  flex-direction: column;\n\n  > * {\n    margin: auto .4em; // @TODO: standardize this size!\n  }\n"]))),Y=function(t){var n=t.children,r=C(t,D);return e.createElement(G,b({className:"FlexCol"},r),n)},Z=g.div(I||(I=M(["\n  display: flex;\n\n  > * {\n    // margin: auto .4em; // @TODO: why? the LoginModal needs no margins!\n  }\n"]))),H=(g.div(N||(N=M(["\n  position: fixed;\n  z-index: 999;\n  overflow: show;\n  margin: auto;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  width: 50px;\n  height: 50px;\n"]))),function(e,t,n){void 0===t&&(t=""),void 0===n&&(n=null),(n="string"==typeof n?n:t.replace(/\W/g,"")).length>0&&"undefined"!=typeof window&&(window[n]=e),console.log("+++ "+t+":",e)}),K=g(u)(S||(S=M(["\n  color: ","\n"])),function(e){return e.theme.colors.text}),Q=g.div(F||(F=M(["\n  flex-grow: 1;\n  text-align: center;\n  font-size: 1.2rem;\n"]))),X=function(t){var n=t.children,r=t.onClose;return C(t,q),e.createElement(Z,null,e.createElement(Q,null,n),e.createElement(W,{onClick:r}))};X.propTypes={onClose:d.func.isRequired},g.div(U||(U=M(["\n  border: ",";\n  border-radius: ",";\n  background: ",";\n  padding: .5em;\n\n  margin-bottom: 1em;\n"])),function(e){return e.theme.thinBorder},function(e){return e.theme.thinBorderRadius},function(e){return e.theme.colors.cardBackground}),g.div(A||(A=M(["\n  border: ",";\n  border-radius: ",";\n  background: ",";\n  color: ",";\n\n  margin: 0 .5em .5em 0;\n  padding: .5em;\n\n  text-align: center;\n\n  width: 18%;\n  max-width: 140px;\n  min-width: 120px;\n"])),function(e){return e.theme.thinBorder},function(e){return e.theme.thinBorderRadius},function(e){return e.theme.colors.cardBackground},function(e){return e.theme.colors.text}),g.div(B||(B=M(["\n  height: 100vh;\n"]))),e.createContext({});var $={LoginModal:"_2YolN",LoginModalOverlay:"_3hqvY",Notice:"_2ifwF"},ee=function(r){var o=r.onError,a=r.onSuccess,l=t(re),i=l.loginModalOpen,c=l.setLoginModalOpen,s=l.setRegisterModalOpen,m=l.useApi,u=n(""),d=u[0],p=u[1],g=n(""),f=g[0],h=g[1],y=m(),E=function(e,t){try{return y.postLogin({email:e,password:t}).then(function(e){c(!1),a(e)}).catch(function(e){o(e)}),Promise.resolve()}catch(e){return Promise.reject(e)}};return v.setAppElement("body"),e.createElement(v,{className:"LoginModal "+$.LoginModal,isOpen:!!i,overlayClassName:$.LoginModalOverlay,portalClassName:$.LoginModalPortal},e.createElement(X,{onClose:function(){return c(!1)}},"Login"),"string"==typeof i&&e.createElement(Z,null,e.createElement("div",{className:$.Notice},i)),e.createElement(Y,null,e.createElement("label",{htmlFor:"email"},"Email"),e.createElement("input",{name:"email",type:"email",value:d,onChange:function(e){return p(e.target.value)}}),e.createElement("label",{htmlFor:"password"},"Password"),e.createElement("input",{name:"password",type:"password",value:f,onChange:function(e){return h(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&E(d,f)}}),e.createElement(Z,{style:{flexDirection:"row-reverse",justifyContent:"space-between",marginTop:"0.4em"}},e.createElement(J,{onClick:function(){return E(d,f)}},"Login"))),e.createElement("hr",{style:{margin:"2rem 0",borderWidth:"1px"}}),e.createElement(Z,{style:{justifyContent:"center"}},e.createElement("a",{onClick:function(){c(!1),s(!0)}},"Register Instead")))};ee.propTypes={onError:d.func,onSuccess:d.func};var te=function(r){var o=t(re),a=o.setLoginModalOpen,l=o.registerModalOpen,i=o.setRegisterModalOpen,c=(0,o.useApi)(),s=n(""),m=s[0],u=s[1],d=n(""),p=d[0],g=d[1],f=n(""),y=f[0],E=f[1];return e.createElement(v,{className:"LoginModal "+$.LoginModal,isOpen:l,overlayClassName:$.LoginModalOverlay,portalClassName:$.LoginModalPortal},e.createElement(X,{onClose:function(){return i(!1)}},"Register"),e.createElement(Y,null,e.createElement("label",{htmlFor:"email"},"Email"),e.createElement("input",{type:"email",name:"email",value:m,onChange:function(e){return u(e.target.value)}}),e.createElement("label",{htmlFor:"password"},"Password"),e.createElement("input",{type:"password",name:"password",value:p,onChange:function(e){return g(e.target.value)}}),e.createElement("label",{htmlFor:"password2"},"Confirm Password"),e.createElement("input",{type:"password",name:"password2",value:y,onChange:function(e){return E(e.target.value)}}),e.createElement(Z,{style:{flexDirection:"row-reverse",justifyContent:"space-between",marginTop:"0.4em"}},e.createElement(J,{className:"Submit",onClick:function(){return function(e,t,n){try{return t!==n?(h("Passwords do not match"),Promise.resolve()):(c.doRegister({email:e,password:t}).then(function(e){i(!1),a(e.message)}).catch(function(e){h("Registration failed")}),Promise.resolve())}catch(e){return Promise.reject(e)}}(m,p,y)}},"Register")),e.createElement("hr",{style:{margin:"2rem 0",borderWidth:"1px"}}),e.createElement(Z,{style:{justifyContent:"center"}},e.createElement("a",{onClick:function(){return a(!0)||i(!1)}},"Login Instead"))))};te.propTypes={};var ne=["children"],re=r({}),oe=function(t){var r=t.children,o=C(t,ne);H(o,"AuthContextProvider");var a=o.currentUser,l=void 0===a?O.anonUser:a,i=o.setCurrentUser,c=o.loginModalOpen,s=void 0!==c&&c,m=o.setLoginModalOpen,u=o.registerModalOpen,d=void 0!==u&&u,p=o.setRegisterModalOpen,g=n(l),f=g[0],h=g[1];i&&(f=l,h=i);var v=n(s),y=v[0],E=v[1];m&&(y=s,E=m);var x=n(d),w=x[0],M=x[1];return p&&(w=d,M=p),e.createElement(re.Provider,{value:b({},o,{currentUser:f,setCurrentUser:h,loginModalOpen:y,setLoginModalOpen:E,registerModalOpen:w,setRegisterModalOpen:M})},r)};oe.propTypes={useApi:d.func.isRequired};const ae=e=>{logg(e,"Marker 2");const{label:t="<none>"}=e;return React.createElement(React.Fragment,null,React.createElement("div",{className:"Card",style:{border:"1px solid red",borderRadius:"10px",padding:"10px",maxWidth:"400px"}},"I am a marker! Label: `",t,"`."))},le=()=>e.createElement(Fragment,null,e.createElement("h1",null,"Hello, world!"),e.createElement(ae,{label:"my-new-label"})),ie=e.createContext({}),ce=t=>{let{children:r,...a}=t;H(a,"JwtContextProvider 222");const{api:l}=a,[i,c]=n({}),[s,m]=n({});return o(()=>{H("setting currentUser..."),l.getMyAccount().then(e=>{H(e,"got this resp"),c(e)}).catch(e=>{H(e,"e322"),h("Login failed: "+e),c({})})},[]),e.createElement(ie.Provider,{value:{api:l,currentUser:i,setCurrentUser:c,loginModalOpen:s,setLoginModalOpen:m}},r)};ce.props={api:d.object};const se=g.div`
  display: flex;

  > * {
    margin: auto .4em;
  }
`,me=g.div`
  border: 1px solid red;
`,ue=g.div`
  display: flex;
`,de=(g.div`
  display: flex;

  > * {
    // margin: auto .4em;
  }
`,()=>{const{setCurrentUser:n}=t(ie);return e.createElement(J,{onClick:()=>{localStorage.removeItem("jwt_token"),n({})}},"Logout")});var pe={__proto__:null,JwtContext:ie,JwtContextProvider:ce,SimpleJwtRow:()=>{const{currentUser:n}=t(ie);return e.createElement(me,null,e.createElement(se,null,n.email&&e.createElement(ue,null,e.createElement("i",null,n.email),e.createElement(de,null))))},Logout:de};const ge=g.div`
`,fe=r=>{const{useApi:o}=t(re),a=o(),[l,i]=n(localStorage.getItem(O.names.scratchpad)||"");return e.createElement(ge,null,e.createElement("textarea",{name:"scratchpad",rows:"20",cols:"40",onChange:e=>i(e.target.value),value:l}),e.createElement(V,null,e.createElement(J,{onClick:()=>{localStorage.setItem(O.names.scratchpad,l),a.postProfile({scratchpad:l}).then(e=>{}).catch(e=>{H("Cannot update profile:",e)})}},"Save")))};fe.propTypes={};const he=g.div`
  height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-content: space-between;
`,ve=t=>{let{children:r,...o}=t;const{listItems:l}=o,[i,c]=e.useState(!1),[s,m]=n(!1),u=p();return e.createElement(a,null,o.variant===O.variants.floating?e.createElement(E,{onClick:()=>c(!0),style:{position:"absolute",top:0,left:0,margin:".5em",zIndex:1},"aria-label":"main menu"},e.createElement(K,null)):e.createElement(K,{onClick:()=>c(!0)}),e.createElement(y,{anchor:"left",open:i,onClose:()=>c(!1)},e.createElement(he,null,e.createElement(x,null,l.map(t=>{let{label:n,key:r,path:o}=t;return e.createElement(w,{button:!0,key:r,onClick:()=>{c(!1),u.push(o())}},n)})),r)))};ve.propTypes={listItems:d.array.isRequired,variant:d.string},process.env.REACT_APP_SERVE&&l.render(e.createElement(le,null),document.getElementById("root"));export{V as Actions,re as AuthContext,oe as AuthContextProvider,W as CloseBtn,Y as FlexCol,Z as FlexRow,ee as LoginModal,X as ModalHeader,te as RegisterModal,fe as Scratchpad,ve as SideMenu,pe as jwtManager,H as logg};
//# sourceMappingURL=index.jsx.modern.js.map
